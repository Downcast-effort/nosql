#Kakfa概述
##首先是一个消息队列：
###消息队列有两种模式：
1、点对点模式（一对一模式），消费者主动拉取数据，收到后消费，这个过程中需要有一个线程主动去拉取数据；
2、发布/订阅模式（一对多模式），这种是消息队列负责推送数据给各个消费者，消费者不用主动去拉数据消费；
###为什么需要消息队列，消息队列有什么好处？
1、解耦，如果没有消息队列，则由一方个另外一方发消息的动作是同步的，但是有了消息队列，它就不需要消息发送者和消费者有任何的关系，这叫解耦；
2、缓冲，这里的缓冲指的是消息队列能保存数据，具有缓冲功能；
3、扩展性，这里的扩展性指的是可以是单机模式，也可以是集群模式；
4、灵活性和峰值处理能力，由于具备缓冲能力，所以在处理数据和峰值处理上具有优势；
5、可恢复性，由于具备缓冲能力，所以数据是可恢复的；
6、顺序保证，由于是队列，所以里面的数据是顺序的；
7、异步通信；
##什么是Kafka
Kafka是一个开源消息系统，其次是一个分布式消息队列，Kafka对消息保存时根据Topic进行归类，发送消息的称为Producer,消息接收者称为Consumer，此外Kafka集群有多个Kafka实例组成，每个实例称为broker,无论是Kakfa集群还是consumer都依赖于zoopker集群保存一些meta信息，来保证系统可用性；
##Kafka架构
多个Producer ---- Kafka集群管理 ---- 多个Consumer
Kafka集群中存在多个实例（broker，通常一台Kafka服务器为一个broker） ，每个实例中存在多个topic，每个topic有自己的分区和副本，主叫leader,副叫follower，一般只有leader挂了follower才会代替leader；
同一个消费者组中的不同的消费者不可以消费同一个topic的同一个分区；
不同消费者组中的两个消费者也不可以消费同一个topic的同一个分区；
消费过程中的offset等等信息有zookeeper控制；
##Kafka在保存副本的时候有同步复制和异步复制？
同步复制：默认保证所有副本将消息复制完成后，默认这条消息提交成功；
异步复制：只要副本接收到生产者推送的消息，就认为消息提交成功；

要实现一条消息被多个消费者同时消费的效果，则将每一个消费者放入单独的一个Consumer group；
要实现一条消息只被一个消费者独占，则将所有消费者放入一个Consumer group；
##分布式模型
Kafka采取的是拉取模型，由消费者自己记录消费状态，每个消费者互相独立的顺序读取每一个分区的消息；
Kafka生产者和消费者相对于服务端都是客户端，生产者客户端发布消息到服务端的指定主题，会指定消息所属的分区，生产者发布消息的时候根据消息是否有键，采用不同的分区策略。消息没有键的时候，通过轮询方式进行客户端负载均衡，消息有键的时候，根据分区予以确保相同键的消息总是发送到同一个分区；
Kakfa消费者通过订阅主题来消费消息，并且每个消费者都会设置一个消费组名称，因为生产者发布到主题的每一条消息都只会发送给消费者组的一个和消费者。
#Kafka的设计与实现
1、如何利用操作系统的优化技术来高效的持久化日志文件和加快数据传输效率？
第一种：采用将多条消息按照分区进行分组，然后采用批量的方式一次发送一个消息集，并且对消息进行压缩，就可以减少网络传输的带宽，进一步提高数据的传输率；
第二种：采用0拷贝技术，只需要将数据从磁盘文件中读取到当前进程中的页面缓冲中，然后直接发送到网卡接口；
2、Kafka的生产者如何批量的发送消息，消费者采取拉取模型带来的优点有哪些？
Kafka的生产者将消息直接发送给分区主副本所在的消息代理节点，并不需要经过任何的中间路由，为了做到这一点，所有消息代理节点都会保存一份相同的元数据，这份数据记录了每一个主题分区对应的主副本节点，生产者客户端在发送消息之前，会向任何一个代理节点请求元数据，并确定每条消息对应的目标节点，然后把消息直接发送给对应的目标节点；
Kafka的消费模式有两种：
第一种：消息代理主动地推送消息给下游的消费者，由消息代理控制数据的传输速率，但是消息代理对于下游消费者接受消息的状态不得而知，消费代理只有调整不同消费者的传输速率，并让每个消费者充分消费才能达到高效，这种实现比较困难。
第二种：基于拉取模型的消费状态处理，主题多个分区，每个消费者只消费一个分区，并且消费者自己记录消费的进度（偏移量），每个消费者只需要为每个分区记录一个整数值，这里不需要服务端再次维护记录消费进度，还有一个好处就是可以回退到某个偏移量以重新消费。正常的开发中是一个死循环，消费者一直处理拉取状态，这样就一直在轮询等待数据的到来，解决此问题：允许消费者的拉取请求以长阻塞、长轮询的方式等待，还可以为消费者客户端设置一个字节数量，当消息代理手机的消息达到这个字节数量的时候，消费者再拉取；
3、Kafka的副本机制如何工作，当故障发生的时候，怎么确保数据不会丢失？
